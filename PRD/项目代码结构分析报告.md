# AIå›¾åƒè§†é¢‘ç”Ÿæˆé¡¹ç›®ä»£ç ç»“æ„åˆ†ææŠ¥å‘Š

## é¡¹ç›®æ•´ä½“æ¶æ„æ¦‚è§ˆ

è¿™æ˜¯ä¸€ä¸ªåŸºäº Next.js 14 çš„å…¨æ ˆ AI å›¾åƒè§†é¢‘ç”Ÿæˆåº”ç”¨ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆå’Œåˆ†å±‚æ¶æ„è®¾è®¡ã€‚

### æŠ€æœ¯æ ˆ
- **å‰ç«¯æ¡†æ¶**: Next.js 14.2.11 (App Router)
- **å¼€å‘è¯­è¨€**: TypeScript 5
- **æ ·å¼æ¡†æ¶**: Tailwind CSS 3.4 + NextUI/HeroUI
- **æ•°æ®åº“**: PostgreSQL
- **èº«ä»½éªŒè¯**: NextAuth.js 4 (Google OAuth)
- **AIæœåŠ¡**: Replicate API
- **äº‘å­˜å‚¨**: AWS S3 / Cloudflare R2
- **æ”¯ä»˜ç³»ç»Ÿ**: Stripe
- **å›½é™…åŒ–**: next-intl

## é¡¹ç›®ç›®å½•ç»“æ„è¯¦ç»†åˆ†æ

### ğŸ“ æ ¹ç›®å½•é…ç½®æ–‡ä»¶
```
â”œâ”€â”€ ğŸ“„ package.json              # é¡¹ç›®ä¾èµ–å’Œè„šæœ¬é…ç½®
â”œâ”€â”€ ğŸ“„ next.config.mjs            # Next.js é…ç½®ï¼ˆå›¾ç‰‡ä¼˜åŒ–ã€å›½é™…åŒ–ï¼‰
â”œâ”€â”€ ğŸ“„ tailwind.config.ts         # Tailwind CSS é…ç½®
â”œâ”€â”€ ğŸ“„ tsconfig.json              # TypeScript é…ç½®
â”œâ”€â”€ ğŸ“„ components.json            # shadcn/ui ç»„ä»¶é…ç½®
â”œâ”€â”€ ğŸ“„ postcss.config.mjs         # PostCSS é…ç½®
â”œâ”€â”€ ğŸ“„ .env.production           # ç”Ÿäº§ç¯å¢ƒå˜é‡
â””â”€â”€ ğŸ“„ CLAUDE.md                  # Claude å¼€å‘æŒ‡å¯¼æ–‡æ¡£
```

### ğŸ“ src/app ç›®å½• - Next.js App Router
```
src/app/
â”œâ”€â”€ ğŸ“ [locale]/                  # å›½é™…åŒ–è·¯ç”±
â”‚   â”œâ”€â”€ ğŸ“ (free)/                # å…¬å¼€é¡µé¢è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ ğŸ“ dashboard/         # ç”¨æˆ·ä»ªè¡¨æ¿
â”‚   â”‚   â”œâ”€â”€ ğŸ“ pricing/           # å®šä»·é¡µé¢
â”‚   â”‚   â”œâ”€â”€ ğŸ“ text-to-image/     # æ–‡å­—ç”Ÿæˆå›¾åƒé¡µé¢
â”‚   â”‚   â”œâ”€â”€ ğŸ“ legal/             # æ³•å¾‹é¡µé¢
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ layout.tsx         # å…¬å¼€é¡µé¢å¸ƒå±€
â”‚   â”‚   â””â”€â”€ ğŸ“„ page.tsx           # é¦–é¡µ
â”‚   â”œâ”€â”€ ğŸ“„ layout.tsx             # æœ¬åœ°åŒ–å¸ƒå±€
â”‚   â””â”€â”€ ğŸ“„ providers.tsx          # åº”ç”¨çº§Provider
â”œâ”€â”€ ğŸ“ api/                       # API è·¯ç”±
â”‚   â”œâ”€â”€ ğŸ“ auth/[...nextauth]/    # NextAuth è®¤è¯
â”‚   â”œâ”€â”€ ğŸ“ webhook/               # Webhook å¤„ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“ stripe/            # Stripe æ”¯ä»˜å›è°ƒ
â”‚   â”‚   â””â”€â”€ ğŸ“ replicate/        # Replicate AI å›è°ƒ
â”‚   â”œâ”€â”€ ğŸ“ predictions/           # AI é¢„æµ‹æ¥å£
â”‚   â”‚   â”œâ”€â”€ ğŸ“ [id]/              # é¢„æµ‹çŠ¶æ€æŸ¥è¯¢
â”‚   â”‚   â”œâ”€â”€ ğŸ“ img_to_video/      # å›¾åƒè½¬è§†é¢‘
â”‚   â”‚   â””â”€â”€ ğŸ“ text_to_image/    # æ–‡å­—ç”Ÿæˆå›¾åƒ
â”‚   â”œâ”€â”€ ğŸ“ effect_result/         # ç”Ÿæˆç»“æœç®¡ç†
â”‚   â”œâ”€â”€ ğŸ“ r2/                   # æ–‡ä»¶ä¸Šä¼ 
â”‚   â”œâ”€â”€ ğŸ“ user/                 # ç”¨æˆ·ç®¡ç†
â”‚   â””â”€â”€ ğŸ“ checkout/             # æ”¯ä»˜ç»“ç®—
â”œâ”€â”€ ğŸ“„ layout.tsx                 # æ ¹å¸ƒå±€
â”œâ”€â”€ ğŸ“„ globals.css               # å…¨å±€æ ·å¼
â””â”€â”€ ğŸ“„ middleware.ts             # ä¸­é—´ä»¶ï¼ˆå›½é™…åŒ–å¤„ç†ï¼‰
```

### ğŸ“ src/backend ç›®å½• - åç«¯ä¸šåŠ¡é€»è¾‘
```
src/backend/
â”œâ”€â”€ ğŸ“ config/                    # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ ğŸ“„ db.ts                  # æ•°æ®åº“è¿æ¥é…ç½®
â”œâ”€â”€ ğŸ“ models/                    # æ•°æ®æ¨¡å‹ï¼ˆæ•°æ®åº“æ“ä½œï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ user.ts                # ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ ğŸ“„ effect.ts              # AIæ•ˆæœæ¨¡å‹
â”‚   â”œâ”€â”€ ğŸ“„ effect_result.ts       # ç”Ÿæˆç»“æœæ¨¡å‹
â”‚   â”œâ”€â”€ ğŸ“„ credit_usage.ts        # ç§¯åˆ†ä½¿ç”¨æ¨¡å‹
â”‚   â”œâ”€â”€ ğŸ“„ payment_history.ts     # æ”¯ä»˜å†å²æ¨¡å‹
â”‚   â”œâ”€â”€ ğŸ“„ subscription_plan.ts    # è®¢é˜…è®¡åˆ’æ¨¡å‹
â”‚   â””â”€â”€ ğŸ“„ user_subscription.ts    # ç”¨æˆ·è®¢é˜…æ¨¡å‹
â”œâ”€â”€ ğŸ“ service/                   # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“„ user.ts                # ç”¨æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“„ effect.ts              # AIæ•ˆæœæœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“„ effect_result.ts       # ç”Ÿæˆç»“æœæœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“„ credit_usage.ts        # ç§¯åˆ†ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“„ payment_history.ts     # æ”¯ä»˜å¤„ç†æœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“„ subscription_plan.ts    # è®¢é˜…è®¡åˆ’æœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“„ user_subscription.ts    # ç”¨æˆ·è®¢é˜…æœåŠ¡
â”‚   â””â”€â”€ ğŸ“„ generate_check.ts       # ç”Ÿæˆæ£€æŸ¥æœåŠ¡
â”œâ”€â”€ ğŸ“ lib/                       # å·¥å…·åº“
â”‚   â””â”€â”€ ğŸ“„ r2.ts                  # R2å­˜å‚¨å·¥å…·
â”œâ”€â”€ ğŸ“ type/                      # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ ğŸ“ domain/                # é¢†åŸŸç±»å‹
â”‚   â””â”€â”€ ğŸ“ enum/                  # æšä¸¾ç±»å‹
â”œâ”€â”€ ğŸ“ utils/                     # å·¥å…·å‡½æ•°
â””â”€â”€ ğŸ“ sql/                       # SQL è„šæœ¬
    â””â”€â”€ ğŸ“„ init.sql               # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
```

### ğŸ“ src/components ç›®å½• - React ç»„ä»¶
```
src/components/
â”œâ”€â”€ ğŸ“ button/                    # æŒ‰é’®ç»„ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ delete-button.tsx      # åˆ é™¤æŒ‰é’®
â”‚   â”œâ”€â”€ ğŸ“„ login-button.tsx       # ç™»å½•æŒ‰é’®
â”‚   â””â”€â”€ ğŸ“„ user-button.tsx        # ç”¨æˆ·æŒ‰é’®
â”œâ”€â”€ ğŸ“ landingpage/              # è½åœ°é¡µç»„ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ top.tsx                # é¡¶éƒ¨æ¨ªå¹…
â”‚   â”œâ”€â”€ ğŸ“„ what.tsx               # åŠŸèƒ½ä»‹ç»
â”‚   â”œâ”€â”€ ğŸ“„ how.tsx                # ä½¿ç”¨è¯´æ˜
â”‚   â”œâ”€â”€ ğŸ“„ feature.tsx            # ç‰¹æ€§å±•ç¤º
â”‚   â”œâ”€â”€ ğŸ“„ faq.tsx                # FAQ
â”‚   â”œâ”€â”€ ğŸ“„ cta.tsx                # è¡ŒåŠ¨å¬å”¤
â”‚   â”œâ”€â”€ ğŸ“„ example.tsx            # ç¤ºä¾‹å±•ç¤º
â”‚   â””â”€â”€ ğŸ“„ credit-info.tsx        # ç§¯åˆ†ä¿¡æ¯
â”œâ”€â”€ ğŸ“ layout/                    # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ ğŸ“ navbar/                # å¯¼èˆªæ 
â”‚   â””â”€â”€ ğŸ“ footer/                # é¡µè„š
â”œâ”€â”€ ğŸ“ price/                     # å®šä»·ç»„ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ app.tsx                 # å®šä»·åº”ç”¨
â”‚   â”œâ”€â”€ ğŸ“„ pricing-tiers.tsx      # å®šä»·å±‚çº§
â”‚   â””â”€â”€ ğŸ“„ pricing-types.tsx      # å®šä»·ç±»å‹
â”œâ”€â”€ ğŸ“ replicate/                 # AI ç”Ÿæˆç»„ä»¶
â”‚   â”œâ”€â”€ ğŸ“ common-logic/          # å…¬å…±é€»è¾‘
â”‚   â”œâ”€â”€ ğŸ“ img-to-video/          # å›¾åƒè½¬è§†é¢‘
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ worker-wraper.tsx  # å·¥ä½œå™¨åŒ…è£…å™¨
â”‚   â”‚   â””â”€â”€ ğŸ“„ worker.tsx          # ä¸»è¦å·¥ä½œç»„ä»¶
â”‚   â””â”€â”€ ğŸ“ text-to-image/         # æ–‡å­—ç”Ÿæˆå›¾åƒ
â”‚       â”œâ”€â”€ ğŸ“„ worker-wraper.tsx  # å·¥ä½œå™¨åŒ…è£…å™¨
â”‚       â”œâ”€â”€ ğŸ“„ worker.tsx          # ä¸»è¦å·¥ä½œç»„ä»¶
â”‚       â””â”€â”€ ğŸ“„ img-output.tsx     # å›¾åƒè¾“å‡ºç»„ä»¶
â””â”€â”€ ğŸ“ seo/                       # SEO ç»„ä»¶
    â””â”€â”€ ğŸ“„ seo.tsx                 # SEO å…ƒæ•°æ®
```

### ğŸ“ å…¶ä»–é‡è¦ç›®å½•
```
src/
â”œâ”€â”€ ğŸ“ config/                    # åº”ç”¨é…ç½®
â”‚   â””â”€â”€ ğŸ“„ colors.json             # é¢œè‰²é…ç½®
â”œâ”€â”€ ğŸ“ contexts/                  # React Context
â”‚   â”œâ”€â”€ ğŸ“„ app.tsx                 # åº”ç”¨ä¸Šä¸‹æ–‡
â”‚   â””â”€â”€ ğŸ“„ theme.tsx               # ä¸»é¢˜ä¸Šä¸‹æ–‡
â”œâ”€â”€ ğŸ“ i18n/                      # å›½é™…åŒ–é…ç½®
â”œâ”€â”€ ğŸ“ lib/                       # å·¥å…·åº“
â”œâ”€â”€ ğŸ“ providers/                 # åº”ç”¨ Provider
â”œâ”€â”€ ğŸ“ types/                     # å…¨å±€ç±»å‹å®šä¹‰
â””â”€â”€ ğŸ“„ middleware.ts              # åº”ç”¨ä¸­é—´ä»¶
```

## æ ¸å¿ƒåŠŸèƒ½é€»è¾‘å…³ç³»

### ğŸ” èº«ä»½éªŒè¯æµç¨‹
```
Google OAuth â†’ NextAuth.js â†’ ç”¨æˆ·æ•°æ®å­˜å‚¨ â†’ Sessionç®¡ç†
    â†“
ç”¨æˆ·ä¿¡æ¯å†™å…¥usersè¡¨ â†’ åˆ›å»ºç§¯åˆ†ä½¿ç”¨è®°å½• â†’ è¿”å›JWT Token
```

### ğŸ’³ æ”¯ä»˜è®¢é˜…æµç¨‹
```
ç”¨æˆ·é€‰æ‹©è®¡åˆ’ â†’ Stripeæ”¯ä»˜ â†’ Webhookå›è°ƒ â†’ æ›´æ–°è®¢é˜…çŠ¶æ€
    â†“
åˆ›å»ºpayment_history â†’ æ›´æ–°user_subscription â†’ åˆ†é…ç§¯åˆ†åˆ°credit_usage
```

### ğŸ¤– AI ç”Ÿæˆæµç¨‹
```
ç”¨æˆ·ä¸Šä¼ /è¾“å…¥ â†’ æ£€æŸ¥ç§¯åˆ† â†’ è°ƒç”¨Replicate API â†’ å¼‚æ­¥å¤„ç†
    â†“
åˆ›å»ºeffect_result â†’ Webhookæ›´æ–°ç»“æœ â†’ ä¸Šä¼ åˆ°R2å­˜å‚¨ â†’ å®ŒæˆçŠ¶æ€æ›´æ–°
```

### ğŸ“Š ç§¯åˆ†ç³»ç»Ÿ
```
è®¢é˜…è®¡åˆ’ â†’ ç§¯åˆ†åˆ†é… â†’ ä½¿ç”¨æ—¶æ‰£é™¤ â†’ å‘¨æœŸæ€§é‡ç½®
    â†“
credit_usageè¡¨è·Ÿè¸ª â†’ effect_resultè®°å½•æ¶ˆè€— â†’ å®æ—¶ä½™é¢æŸ¥è¯¢
```

## æ•°æ®åº“è¡¨å…³ç³»å›¾

```mermaid
erDiagram
    users ||--o{ credit_usage : "1:N"
    users ||--o{ effect_result : "1:N"
    users ||--o{ user_subscriptions : "1:N"
    users ||--o{ payment_history : "1:N"
    
    subscription_plans ||--o{ user_subscriptions : "1:N"
    subscription_plans ||--o{ payment_history : "1:N"
    
    effect ||--o{ effect_result : "1:N"
    
    user_subscriptions ||--o{ credit_usage : "1:N"
    
    users {
        text uuid PK
        text email
        text nickname
        text avatar_url
        timestamp created_at
    }
    
    effect {
        integer id PK
        text name
        text model
        real credit
        text api
    }
    
    effect_result {
        integer id PK
        text user_id FK
        integer effect_id FK
        text status
        text url
        integer credit
    }
    
    credit_usage {
        integer id PK
        text user_id FK
        integer used_count
        timestamp period_start
        timestamp period_end
    }
    
    subscription_plans {
        integer id PK
        text name
        numeric price
        integer credit_per_interval
    }
    
    user_subscriptions {
        integer id PK
        text user_id FK
        text stripe_subscription_id
        timestamp current_period_start
        timestamp current_period_end
    }
```

## å…³é”®æŠ€æœ¯ç‰¹ç‚¹

### 1. **åˆ†å±‚æ¶æ„**
- **è¡¨ç°å±‚**: Reactç»„ä»¶ + Next.jsé¡µé¢
- **ä¸šåŠ¡å±‚**: Serviceå±‚å¤„ç†ä¸šåŠ¡é€»è¾‘
- **æ•°æ®å±‚**: Modelå±‚å¤„ç†æ•°æ®åº“æ“ä½œ
- **é›†æˆå±‚**: APIè·¯ç”±å¤„ç†å¤–éƒ¨æœåŠ¡

### 2. **å¼‚æ­¥å¤„ç†**
- Replicate AIç”Ÿæˆé‡‡ç”¨å¼‚æ­¥æ¨¡å¼
- Webhookæœºåˆ¶å¤„ç†ç»“æœå›è°ƒ
- é˜Ÿåˆ—åŒ–å¤„ç†é¿å…é˜»å¡

### 3. **å¤šç§Ÿæˆ·è®¾è®¡**
- åŸºäºç”¨æˆ·çš„ç§¯åˆ†ç³»ç»Ÿ
- è®¢é˜…è®¡åˆ’ç®¡ç†
- æƒé™æ§åˆ¶å’Œè®¿é—®é™åˆ¶

### 4. **å¯æ‰©å±•æ€§**
- æ¨¡å—åŒ–ç»„ä»¶è®¾è®¡
- é…ç½®åŒ–çš„AIæ•ˆæœç®¡ç†
- å›½é™…åŒ–æ”¯æŒ

## å¼€å‘å»ºè®®

### ä»£ç ç»„ç»‡
- éµå¾ªåˆ†å±‚æ¶æ„ï¼Œé¿å…è·¨å±‚è°ƒç”¨
- ä½¿ç”¨TypeScriptä¸¥æ ¼ç±»å‹æ£€æŸ¥
- ç»„ä»¶åŒ–å¼€å‘ï¼Œæé«˜å¤ç”¨æ€§

### æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨Next.jså›¾ç‰‡ä¼˜åŒ–
- å®ç°æ‡’åŠ è½½å’Œä»£ç åˆ†å‰²
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

### å®‰å…¨è€ƒè™‘
- ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
- APIè·¯ç”±è®¤è¯å’Œæˆæƒ
- è¾“å…¥éªŒè¯å’ŒSQLæ³¨å…¥é˜²æŠ¤

è¿™ä¸ªé¡¹ç›®å±•ç°äº†ç°ä»£Webåº”ç”¨çš„æœ€ä½³å®è·µï¼Œå…·æœ‰è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚